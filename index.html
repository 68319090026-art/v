<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIEWVI MONITORING PRO</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #00f2ff; /* ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
            --bg: #0b0e14; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
            --card: rgba(23, 28, 38, 0.8); /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á */
            --danger: #ff3e3e; /* ‡πÅ‡∏î‡∏á */
            --success: #39ff14; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
            --warning: #ffaa00; /* ‡∏™‡πâ‡∏° */
            --text-light: #e2e8f0;
            --text-muted: #718096;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background: var(--bg);
            color: var(--text-light);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô scroll bar ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á */
            position: relative;
        }

        /* --- ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß (Animated Background) --- */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #1a2332, #0b0e14, #1a2332);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            z-index: -2;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M100 0L0 100V0z" fill="rgba(0,242,255,0.05)"%3E%3C/path%3E%3C/svg%3E');
            background-size: 20px 20px;
            animation: moveGrid 60s linear infinite;
            z-index: -1;
            opacity: 0.5;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes moveGrid {
            0% { background-position: 0 0; }
            100% { background-position: 100px 100px; }
        }

        .dashboard {
            width: 95%;
            max-width: 1200px;
            padding: 40px 20px;
            z-index: 1; /* ‡πÉ‡∏´‡πâ Dashboard ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 20px;
        }
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: var(--accent);
            text-shadow: 0 0 15px rgba(0, 242, 255, 0.5);
            margin: 0;
            letter-spacing: 2px;
        }
        .status-dot {
            display: inline-block;
            width: 10px; height: 10px;
            background-color: var(--success);
            border-radius: 50%;
            margin-left: 10px;
            animation: pulse 1.5s infinite alternate;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(57, 255, 20, 0.7); }
            100% { box-shadow: 0 0 0 10px rgba(57, 255, 20, 0); }
        }

        #clock {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            color: #fff;
            font-weight: bold;
        }

        /* Main Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: var(--card);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.05);
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* Gauge */
        .gauge-container {
            width: 50px; height: 150px;
            background: #000;
            border-radius: 25px;
            margin: 15px auto;
            position: relative;
            overflow: hidden;
            border: 2px solid #2d3748;
        }
        #temp-bar {
            position: absolute; bottom: 0; width: 100%; height: 0%;
            background: linear-gradient(to top, var(--accent), var(--success), var(--warning), var(--danger));
            transition: 1s ease-out;
        }

        .value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            color: #fff;
        }
        .unit {
            font-size: 1rem;
            color: var(--text-muted);
        }

        /* Log Table */
        .log-section {
            background: var(--card);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .log-table-wrapper {
            max-height: 250px;
            overflow-y: auto;
            border-radius: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }
        th {
            color: var(--accent);
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            background: #171c26;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
        }
        td {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.9rem;
        }
        .tag-alert {
            background: rgba(255, 62, 62, 0.2);
            color: var(--danger);
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: bold;
        }

        /* --- Device Status Bar --- */
        .device-status-bar {
            background: var(--card);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            margin-top: 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .device-indicator {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .device-led {
            width: 15px; height: 15px;
            border-radius: 50%;
            background: #4a5568; /* ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏° */
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
            margin-bottom: 8px;
            transition: all 0.3s ease-in-out;
        }
        .device-led.on {
            background: var(--accent);
            box-shadow: 0 0 15px var(--accent), inset 0 0 8px rgba(255,255,255,0.5);
        }
        .device-icon {
            font-size: 2rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .device-icon.on {
            color: var(--success);
            text-shadow: 0 0 10px var(--success);
        }
        .device-text {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
        }
        .device-text.on {
            color: var(--success);
            font-weight: bold;
        }
        .device-text.off {
            color: var(--danger);
            font-weight: bold;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #00e0ef; }

    </style>
</head>
<body>

<div class="dashboard">
    <div class="header">
        <h1>VIEWVI MONITORING PRO <span class="status-dot"></span></h1>
        <div id="clock">00:00:00</div>
    </div>

    <div class="grid">
        <div class="card">
            <div style="color: var(--accent); font-weight: 500;">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</div>
            <div class="gauge-container"><div id="temp-bar"></div></div>
            <div><span class="value" id="t-val">--</span><span class="unit">¬∞C</span></div>
        </div>

        <div class="card">
            <div style="color: var(--success); font-weight: 500;">‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°</div>
            <div style="margin-top: 30px;">
                <small style="color: var(--text-muted);">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</small>
                <div class="value" id="h-val">--<span class="unit">%</span></div>
            </div>
            <div style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 20px;">
                <small style="color: var(--text-muted);">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏î‡∏¥‡∏ô</small>
                <div class="value" id="s-val" style="color: var(--success);">--<span class="unit">%</span></div>
            </div>
        </div>

        <div class="card">
            <div style="color: var(--danger); font-weight: 500;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</div>
            <div id="sec-icon" style="font-size: 5rem; margin: 30px 0; transition: color 0.3s, text-shadow 0.3s;">üõ°Ô∏è</div>
            <div id="sec-text" style="font-size: 1.4rem; font-weight: bold; color: var(--success);">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥</div>
        </div>
    </div>

    <div class="log-section">
        <div class="log-header">
            <h3 style="margin:0; color: var(--accent); font-weight: 500;">üìä ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå</h3>
            <button onclick="clearLogs()" style="background: transparent; border: 1px solid #444; color: var(--text-muted); padding: 5px 10px; border-radius: 5px; cursor: pointer;">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
        </div>
        <div class="log-table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                        <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    </tr>
                </thead>
                <tbody id="log-body"></tbody>
            </table>
        </div>
    </div>

    <div class="device-status-bar">
        <div class="device-indicator">
            <div class="device-led" id="device-led1"></div>
            <div style="font-size: 0.9rem; color: var(--text-light);">LED 1</div>
            <div class="device-text" id="status-led1">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
        </div>
        <div class="device-indicator">
            <div class="device-led" id="device-led2"></div>
            <div style="font-size: 0.9rem; color: var(--text-light);">LED 2</div>
            <div class="device-text" id="status-led2">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
        </div>
        <div class="device-indicator">
            <div class="device-icon" id="speaker-icon">üîä</div>
            <div style="font-size: 0.9rem; color: var(--text-light);">‡∏•‡∏≥‡πÇ‡∏û‡∏á (Buzzer)</div>
            <div class="device-text" id="status-speaker">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
        </div>
    </div>

</div>

<script>
    const firebaseConfig = { databaseURL: "https://viewvi-3e5ef-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let lastSecurityState = 0;
    let lastTempState = false;
    let lastBuzzerState = false; // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏≥‡πÇ‡∏û‡∏á

    function addLog(type, message, statusClass) {
        const tbody = document.getElementById("log-body");
        const row = document.createElement("tr");
        const now = new Date().toLocaleTimeString('th-TH');
        row.innerHTML = `
            <td>${now}</td>
            <td>${type}</td>
            <td>${message}</td>
            <td><span class="${statusClass}">${statusClass === 'tag-alert' ? '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô' : '‡∏õ‡∏Å‡∏ï‡∏¥'}</span></td>
        `;
        tbody.prepend(row);
        if (tbody.rows.length > 50) tbody.deleteRow(50);
    }

    function clearLogs() { document.getElementById("log-body").innerHTML = ""; }

    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('th-TH'); }, 1000);

    db.ref("/").on("value", (snapshot) => {
        const data = snapshot.val();
        if (data) {
            // --- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å ---
            const t = data.temperature || 0;
            document.getElementById("t-val").innerText = t;
            document.getElementById("temp-bar").style.height = Math.min(t * 2, 100) + "%"; // Max 100%
            document.getElementById("h-val").innerHTML = (data.Humidity || "--") + "<span class='unit'>%</span>";
            document.getElementById("s-val").innerHTML = (data.Soil || "--") + "<span class='unit'>%</span>";

            // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Log ---
            const isAlert = data.Security == 1;
            document.getElementById("sec-icon").innerText = isAlert ? "üö®" : "üõ°Ô∏è";
            const secText = document.getElementById("sec-text");
            secText.innerText = isAlert ? "‚ö†Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏∏‡∏Å‡∏£‡∏∏‡∏Å!" : "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥";
            secText.style.color = isAlert ? "var(--danger)" : "var(--success)";

            if (isAlert && lastSecurityState === 0) {
                addLog("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢", "‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà", "tag-alert");
                lastSecurityState = 1;
            } else if (!isAlert) {
                lastSecurityState = 0;
            }

            // --- ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Log ---
            if (t > 30 && !lastTempState) {
                addLog("‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥", `‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏™‡∏π‡∏á: ${t}¬∞C`, "tag-alert");
                lastTempState = true;
            } else if (t <= 30) {
                lastTempState = false;
            }

            // --- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ LED 1, LED 2, ‡∏•‡∏≥‡πÇ‡∏û‡∏á (‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) ---
            // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤ LED 1 ‡πÅ‡∏•‡∏∞ LED 2 ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô 0/1 ‡πÉ‡∏ô Firebase (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏¥‡πà‡∏°)
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ú‡∏π‡∏Å LED1 ‡∏Å‡∏±‡∏ö Security ‡πÅ‡∏•‡∏∞ LED2 ‡∏Å‡∏±‡∏ö‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥
            const led1State = isAlert; // LED1 ‡∏ï‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠ Security Alert
            const led2State = (t > 30); // LED2 ‡∏ï‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠ Temp > 30

            // LED 1 (‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Security)
            const deviceLed1 = document.getElementById("device-led1");
            const statusLed1 = document.getElementById("status-led1");
            if (led1State) {
                deviceLed1.classList.add("on");
                statusLed1.innerText = "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
                statusLed1.classList.add("on");
                statusLed1.classList.remove("off");
            } else {
                deviceLed1.classList.remove("on");
                statusLed1.innerText = "‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
                statusLed1.classList.add("off");
                statusLed1.classList.remove("on");
            }

            // LED 2 (‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥)
            const deviceLed2 = document.getElementById("device-led2");
            const statusLed2 = document.getElementById("status-led2");
            if (led2State) {
                deviceLed2.classList.add("on");
                statusLed2.innerText = "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
                statusLed2.classList.add("on");
                statusLed2.classList.remove("off");
            } else {
                deviceLed2.classList.remove("on");
                statusLed2.innerText = "‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
                statusLed2.classList.add("off");
                statusLed2.classList.remove("on");
            }

            // ‡∏•‡∏≥‡πÇ‡∏û‡∏á (‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Buzzer / Security)
            const speakerIcon = document.getElementById("speaker-icon");
            const statusSpeaker = document.getElementById("status-speaker");
            if (isAlert) { // ‡∏•‡∏≥‡πÇ‡∏û‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ Security Alert
                speakerIcon.classList.add("on");
                statusSpeaker.innerText = "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
                statusSpeaker.classList.add("on");
                statusSpeaker.classList.remove("off");
            } else {
                speakerIcon.classList.remove("on");
                statusSpeaker.innerText = "‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
                statusSpeaker.classList.add("off");
                statusSpeaker.classList.remove("on");
            }
        }
    });
</script>
</body>
</html>
