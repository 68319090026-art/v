<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temperature IoT (Firebase)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* (‡πÉ‡∏ä‡πâ Style ‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°) */
        body { font-family: Tahoma; text-align: center; color: white; background: #222; padding: 20px; }
        .card { background: #333; max-width: 400px; margin: auto; padding: 20px; border-radius: 20px; }
        .temp { font-size: 50px; font-weight: bold; margin: 20px 0; }
        button { padding: 15px 30px; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; color: white; margin: 5px;}
        .on { background: #2ecc71; }
        .off { background: #e74c3c; }
    </style>
</head>
<body>
    <div class="card">
        <h2>üå° ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏±‡∏î‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (Online)</h2>
        <div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>
        <div class="temp" id="temp">-- ¬∞C</div>
        
        <canvas id="chart"></canvas>

        <br>
        <button class="on" onclick="setSystem(true)">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö</button>
        <button class="off" onclick="setSystem(false)">‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <script>
        // ==========================================
        // üëá ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Firebase ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ / ‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢)
        const DB_URL = "https://viewvi-3e5ef-default-rtdb.firebaseio.com/";
        // ==========================================

        let labels = [], temps = [];
        const ctx = document.getElementById('chart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{ label: 'Temperature', data: temps, borderColor: '#4fc3f7', tension: 0.4 }]
            }
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        async function loadData() {
            try {
                // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏à‡∏≤‡∏Å Firebase ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                let res = await fetch(DB_URL + ".json");
                let data = await res.json();

                if (data) {
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥
                    document.getElementById("temp").innerText = (data.temperature || 0) + " ¬∞C";
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                    let statusText = document.getElementById("status");
                    if (data.systemOn) {
                        statusText.innerText = "üü¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà";
                        statusText.style.color = "#2ecc71";
                    } else {
                        statusText.innerText = "üî¥ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î";
                        statusText.style.color = "#e74c3c";
                    }

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü
                    let timeStr = new Date().toLocaleTimeString();
                    if (labels.length > 10) { labels.shift(); temps.shift(); }
                    labels.push(timeStr);
                    temps.push(data.temperature);
                    chart.update();
                }
            } catch (err) {
                console.error(err);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô (‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ Firebase)
        async function setSystem(isOn) {
            await fetch(DB_URL + "systemOn.json", {
                method: "PUT",
                body: JSON.stringify(isOn)
            });
            loadData(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        }

        setInterval(loadData, 3000); // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        loadData();
    </script>
</body>
</html>
