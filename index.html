<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIEWVI MONITORING PRO</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #00f2ff; --bg: #0b0e14; --card: rgba(23, 28, 38, 0.85);
            --danger: #ff3e3e; --success: #39ff14; --warning: #ffaa00;
        }

        body {
            font-family: 'Kanit', sans-serif; background: var(--bg); color: #e2e8f0;
            margin: 0; display: flex; justify-content: center; min-height: 100vh;
            overflow-x: hidden; position: relative;
        }

        /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß */
        .glow-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(125deg, transparent 0%, rgba(0, 242, 255, 0.05) 50%, transparent 100%);
            background-size: 200% 200%; animation: moveGlow 10s linear infinite; z-index: -1;
        }
        @keyframes moveGlow { 0% { background-position: 200% 0%; } 100% { background-position: -200% 0%; } }

        .dashboard { width: 95%; max-width: 1200px; padding: 40px 20px; z-index: 1; }

        /* Header + ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏•‡∏≤ */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        h1 { font-family: 'Orbitron'; color: var(--accent); text-shadow: 0 0 15px rgba(0, 242, 255, 0.5); margin: 0; }
        .time-box { text-align: right; font-family: 'Orbitron'; }
        #date { font-size: 0.9rem; color: var(--accent); opacity: 0.8; }
        #clock { font-size: 1.5rem; font-weight: bold; color: #fff; }

        /* Grid & Cards */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .card { background: var(--card); backdrop-filter: blur(15px); border-radius: 20px; padding: 25px; border: 1px solid rgba(255,255,255,0.05); text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        /* Gauge */
        .gauge-container { width: 50px; height: 120px; background: #000; border-radius: 25px; margin: 15px auto; position: relative; overflow: hidden; border: 2px solid #2d3748; }
        #temp-bar { position: absolute; bottom: 0; width: 100%; height: 0%; background: linear-gradient(to top, var(--accent), var(--warning), var(--danger)); transition: 1s; }
        .value { font-family: 'Orbitron'; font-size: 2.5rem; font-weight: 700; }

        /* --- ‡πÅ‡∏ñ‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü‡πÄ‡∏Å‡πã‡πÜ) --- */
        .device-status-bar {
            background: var(--card); backdrop-filter: blur(15px); border-radius: 20px;
            padding: 25px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;
            display: flex; justify-content: space-around;
        }
        .device-indicator { text-align: center; perspective: 500px; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü */
        .bulb-icon {
            font-size: 3rem; color: #333; transition: 0.4s; filter: grayscale(1); opacity: 0.3;
            margin-bottom: 5px; display: block;
        }
        .bulb-icon.on {
            color: #ffff00; filter: grayscale(0); opacity: 1;
            text-shadow: 0 0 20px #ffff00, 0 0 40px #ffaa00;
            transform: scale(1.1);
        }

        .status-text { font-size: 0.85rem; font-weight: bold; margin-top: 5px; }
        .status-on { color: var(--success); text-shadow: 0 0 5px var(--success); }
        .status-off { color: var(--danger); }

        /* Log Table */
        .log-section { background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid rgba(255,255,255,0.05); }
        .log-table-wrapper { max-height: 250px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { color: var(--accent); padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); sticky; top: 0; background: #171c26; font-size: 0.8rem; }
        td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.85rem; }
    </style>
</head>
<body>

<div class="glow-bg"></div>

<div class="dashboard">
    <div class="header">
        <h1>VIEWVI MONITORING PRO</h1>
        <div class="time-box">
            <div id="date">--/--/----</div>
            <div id="clock">00:00:00</div>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <div style="color: var(--accent);">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</div>
            <div class="gauge-container"><div id="temp-bar"></div></div>
            <span class="value" id="t-val">--</span><small>¬∞C</small>
        </div>
        <div class="card">
            <div style="color: var(--success);">‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°</div>
            <div style="margin-top: 20px;">
                <small>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</small><br>
                <span class="value" id="h-val">--</span><small>%</small>
            </div>
            <div style="margin-top: 15px;">
                <small>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô</small><br>
                <span class="value" id="s-val" style="color: var(--success);">--</span><small>%</small>
            </div>
        </div>
        <div class="card">
            <div style="color: var(--danger);">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</div>
            <div id="sec-icon" style="font-size: 4rem; margin: 20px 0;">üõ°Ô∏è</div>
            <div id="sec-text" style="font-size: 1.2rem; font-weight: bold; color: var(--success);">‡∏õ‡∏Å‡∏ï‡∏¥</div>
        </div>
    </div>

    <div class="device-status-bar">
        <div class="device-indicator">
            <span class="bulb-icon" id="led1-bulb">üí°</span>
            <div style="font-size: 0.9rem;">LED 1</div>
            <div class="status-text status-off" id="led1-text">‡∏õ‡∏¥‡∏î</div>
        </div>
        <div class="device-indicator">
            <span class="bulb-icon" id="led2-bulb">üí°</span>
            <div style="font-size: 0.9rem;">LED 2</div>
            <div class="status-text status-off" id="led2-text">‡∏õ‡∏¥‡∏î</div>
        </div>
        <div class="device-indicator">
            <div style="font-size: 2.5rem; margin-bottom: 5px; transition: 0.3s;" id="speaker-icon">üîá</div>
            <div style="font-size: 0.9rem;">‡∏•‡∏≥‡πÇ‡∏û‡∏á (Buzzer)</div>
            <div class="status-text status-off" id="buzzer-text">‡∏õ‡∏¥‡∏î</div>
        </div>
    </div>

    <div class="log-section">
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
            <h3 style="margin:0; color: var(--accent);">üìä ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå</h3>
            <button onclick="clearLogs()" style="background: transparent; border: 1px solid #444; color: #718096; cursor: pointer; border-radius: 5px; padding: 2px 10px;">‡∏•‡πâ‡∏≤‡∏á</button>
        </div>
        <div class="log-table-wrapper">
            <table>
                <thead>
                    <tr><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr>
                </thead>
                <tbody id="log-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://viewvi-3e5ef-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let lastSec = 0; let lastT = false;

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
    function updateTime() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('date').innerText = now.toLocaleDateString('th-TH', options);
        document.getElementById('clock').innerText = now.toLocaleTimeString('th-TH');
    }
    setInterval(updateTime, 1000);

    function addLog(type, msg, cls) {
        const tbody = document.getElementById("log-body");
        const row = document.createElement("tr");
        const time = new Date().toLocaleTimeString('th-TH');
        row.innerHTML = `<td>${time}</td><td>${type}</td><td>${msg}</td><td><span style="color:${cls === 'tag-alert' ? '#ff3e3e' : '#39ff14'}">${cls === 'tag-alert' ? '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô' : '‡∏õ‡∏Å‡∏ï‡∏¥'}</span></td>`;
        tbody.prepend(row);
        if (tbody.rows.length > 50) tbody.deleteRow(50);
    }

    function clearLogs() { document.getElementById("log-body").innerHTML = ""; }

    db.ref("/").on("value", (snapshot) => {
        const data = snapshot.val();
        if (data) {
            const t = data.temperature || 0;
            const isAlert = data.Security == 1;

            document.getElementById("t-val").innerText = t;
            document.getElementById("temp-bar").style.height = (t * 2) + "%";
            document.getElementById("h-val").innerText = data.Humidity || "--";
            document.getElementById("s-val").innerText = data.Soil || "--";
            
            document.getElementById("sec-icon").innerText = isAlert ? "üö®" : "üõ°Ô∏è";
            const secT = document.getElementById("sec-text");
            secT.innerText = isAlert ? "‚ö†Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏!" : "‡∏õ‡∏Å‡∏ï‡∏¥";
            secT.style.color = isAlert ? "var(--danger)" : "var(--success)";

            // --- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü‡πÅ‡∏•‡∏∞‡∏•‡∏≥‡πÇ‡∏û‡∏á ---
            const bulb1 = document.getElementById("led1-bulb");
            const led1T = document.getElementById("led1-text");
            const bulb2 = document.getElementById("led2-bulb");
            const led2T = document.getElementById("led2-text");
            const spkIcon = document.getElementById("speaker-icon");
            const buzT = document.getElementById("buzzer-text");

            // LED 1 & Buzzer (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ Security Alert)
            if(isAlert) {
                bulb1.classList.add("on"); led1T.innerText = "‡πÄ‡∏õ‡∏¥‡∏î"; led1T.className = "status-text status-on";
                spkIcon.innerText = "üîä"; buzT.innerText = "‡πÄ‡∏õ‡∏¥‡∏î"; buzT.className = "status-text status-on";
                spkIcon.style.color = "var(--success)"; spkIcon.style.textShadow = "0 0 10px var(--success)";
            } else {
                bulb1.classList.remove("on"); led1T.innerText = "‡∏õ‡∏¥‡∏î"; led1T.className = "status-text status-off";
                spkIcon.innerText = "üîá"; buzT.innerText = "‡∏õ‡∏¥‡∏î"; buzT.className = "status-text status-off";
                spkIcon.style.color = "#333"; spkIcon.style.textShadow = "none";
            }

            // LED 2 (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ > 30)
            if(t > 30) {
                bulb2.classList.add("on"); led2T.innerText = "‡πÄ‡∏õ‡∏¥‡∏î"; led2T.className = "status-text status-on";
            } else {
                bulb2.classList.remove("on"); led2T.innerText = "‡∏õ‡∏¥‡∏î"; led2T.className = "status-text status-off";
            }

            // --- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå ---
            if (isAlert && lastSec === 0) { addLog("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢", "‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ö‡∏∏‡∏Å‡∏£‡∏∏‡∏Å", "tag-alert"); lastSec = 1; }
            else if (!isAlert) { lastSec = 0; }
            if (t > 30 && !lastT) { addLog("‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥", `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏™‡∏π‡∏á: ${t}¬∞C`, "tag-alert"); lastT = true; }
            else if (t <= 30) { lastT = false; }
        }
    });
</script>
</body>
</html>
