<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIEWVI COMMAND CENTER : ELITE</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #00f2ff; --bg: #05070a; --card: rgba(13, 17, 23, 0.9);
            --danger: #ff003c; --success: #00ff9d; --warning: #ffcc00;
        }

        /* --- ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á Cybernetic ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° --- */
        body {
            font-family: 'Kanit', sans-serif; background: var(--bg); color: #fff;
            margin: 0; display: flex; justify-content: center; min-height: 100vh; overflow-x: hidden;
        }

        .bg-animate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 242, 255, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(255, 0, 60, 0.05) 0%, transparent 40%),
                linear-gradient(to bottom, #05070a, #0d1117);
        }

        .grid-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0, 242, 255, 0.03) 1px, transparent 1px), 
                              linear-gradient(90deg, rgba(0, 242, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px; z-index: -1; animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove { from { transform: translateY(0); } to { transform: translateY(50px); } }

        .dashboard { width: 95%; max-width: 1200px; padding: 40px 20px; }

        /* Header */
        .header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; border-left: 5px solid var(--accent); padding-left: 20px; }
        h1 { font-family: 'Orbitron'; font-size: 1.8rem; margin: 0; letter-spacing: 4px; color: var(--accent); text-shadow: 0 0 20px var(--accent); }
        .info-panel { text-align: right; font-family: 'Orbitron'; }
        #date { color: var(--accent); font-size: 0.85rem; letter-spacing: 1px; }
        #clock { font-size: 2rem; font-weight: 900; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.3); }

        /* Cards */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; margin-bottom: 25px; }
        .card { 
            background: var(--card); border-radius: 24px; padding: 30px; border: 1px solid rgba(0, 242, 255, 0.1); 
            box-shadow: 0 15px 35px rgba(0,0,0,0.8); position: relative; overflow: hidden;
        }
        .card::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--accent); box-shadow: 0 0 15px var(--accent); opacity: 0.5; }

        /* ‡∏´‡∏•‡∏≠‡∏î‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á (Glow Gauge) */
        .gauge-wrap { width: 60px; height: 160px; background: #000; border-radius: 30px; margin: 20px auto; position: relative; border: 2px solid #1a202c; padding: 5px; box-shadow: inset 0 0 10px rgba(0,0,0,1); }
        #temp-bar { 
            position: absolute; bottom: 8px; left: 8px; right: 8px; width: calc(100% - 16px); height: 0%; 
            border-radius: 20px; transition: 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: linear-gradient(to top, #00f2ff, #00ff9d, #ffcc00, #ff003c);
            box-shadow: 0 0 25px rgba(0, 242, 255, 0.6); 
        }

        .value { font-family: 'Orbitron'; font-size: 3rem; font-weight: 700; color: #fff; }

        /* Status Bar ‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü */
        .device-bar { background: var(--card); border-radius: 24px; padding: 30px; display: flex; justify-content: space-around; margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.05); }
        .bulb-box { text-align: center; }
        .bulb-icon { font-size: 3.5rem; color: #1a202c; transition: 0.5s; filter: drop-shadow(0 0 0px transparent); opacity: 0.2; }
        .bulb-icon.on { opacity: 1; color: #fffb00; filter: drop-shadow(0 0 20px #fffb00); transform: scale(1.1) translateY(-5px); }

        /* Log Table */
        .log-box { background: var(--card); border-radius: 24px; padding: 25px; border: 1px solid rgba(255,255,255,0.05); }
        .table-container { max-height: 300px; overflow-y: auto; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; }
        th { font-family: 'Orbitron'; color: var(--accent); padding: 15px; text-align: left; border-bottom: 2px solid rgba(0,242,255,0.1); font-size: 0.8rem; }
        td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.02); font-size: 0.9rem; color: #cbd5e0; }
        .tag { padding: 4px 10px; border-radius: 6px; font-weight: bold; font-size: 0.75rem; text-transform: uppercase; }
        .tag-alert { background: rgba(255, 0, 60, 0.15); color: var(--danger); border: 1px solid var(--danger); }
        .tag-normal { background: rgba(0, 255, 157, 0.15); color: var(--success); border: 1px solid var(--success); }

    </style>
</head>
<body>

<div class="bg-animate"></div>
<div class="grid-overlay"></div>

<div class="dashboard">
    <div class="header">
        <div><h1>SYSTEM COMMAND</h1><div style="font-size: 0.8rem; color: var(--success);">‚óè SECURE CONNECTION ACTIVE</div></div>
        <div class="info-panel">
            <div id="date">--/--/----</div>
            <div id="clock">00:00:00</div>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <div style="font-family: 'Orbitron'; color: var(--accent); letter-spacing: 2px;">TEMPERATURE</div>
            <div class="gauge-wrap"><div id="temp-bar"></div></div>
            <span class="value" id="t-val">--</span><span style="font-size: 1.2rem; color: var(--accent);">¬∞C</span>
        </div>
        <div class="card">
            <div style="font-family: 'Orbitron'; color: var(--success); letter-spacing: 2px;">ENVIRONMENT</div>
            <div style="margin-top: 40px;">
                <small style="color: #718096; text-transform: uppercase;">Humidity</small><br>
                <span class="value" id="h-val">--</span><span style="font-size: 1.2rem; color: var(--success);">%</span>
            </div>
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.05);">
                <small style="color: #718096; text-transform: uppercase;">Soil Moisture</small><br>
                <span class="value" id="s-val" style="color: var(--success);">--</span><span style="font-size: 1.2rem; color: var(--success);">%</span>
            </div>
        </div>
        <div class="card">
            <div style="font-family: 'Orbitron'; color: var(--danger); letter-spacing: 2px;">SECURITY</div>
            <div id="sec-icon" style="font-size: 6rem; margin: 40px 0; transition: 0.5s;">üõ°Ô∏è</div>
            <div id="sec-text" style="font-size: 1.5rem; font-weight: bold; color: var(--success);">STATUS READY</div>
        </div>
    </div>

    <div class="device-bar">
        <div class="bulb-box">
            <span class="bulb-icon" id="bulb1">üí°</span>
            <div style="font-size: 0.8rem; font-family: 'Orbitron'; margin-top: 10px;">LED 1</div>
            <div id="led1-status" style="font-size: 0.75rem; color: var(--danger);">OFFLINE</div>
        </div>
        <div class="bulb-box">
            <span class="bulb-icon" id="bulb2">üí°</span>
            <div style="font-size: 0.8rem; font-family: 'Orbitron'; margin-top: 10px;">LED 2</div>
            <div id="led2-status" style="font-size: 0.75rem; color: var(--danger);">OFFLINE</div>
        </div>
        <div class="bulb-box">
            <div id="spk-icon" style="font-size: 3rem; opacity: 0.3;">üîá</div>
            <div style="font-size: 0.8rem; font-family: 'Orbitron'; margin-top: 15px;">BUZZER</div>
            <div id="bz-status" style="font-size: 0.75rem; color: var(--danger);">OFFLINE</div>
        </div>
    </div>

    <div class="log-box">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2 style="font-family: 'Orbitron'; font-size: 1rem; color: var(--accent); margin: 0;">LOGGING HISTORY</h2>
            <button onclick="clearLogs()" style="background: transparent; border: 1px solid #333; color: #555; cursor: pointer; border-radius: 4px; padding: 4px 12px; font-size: 0.7rem;">PURGE LOGS</button>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>TIMESTAMP</th><th>CATEGORY</th><th>MESSAGE</th><th>STATUS</th></tr>
                </thead>
                <tbody id="log-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://viewvi-3e5ef-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let lastSec = 0; let lastT = false;

    function updateClock() {
        const now = new Date();
        document.getElementById('date').innerText = now.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
        document.getElementById('clock').innerText = now.toLocaleTimeString('th-TH');
    }
    setInterval(updateClock, 1000);

    function addLog(type, msg, isAlert) {
        const tbody = document.getElementById("log-body");
        const row = document.createElement("tr");
        const now = new Date();
        const dateStr = now.toLocaleDateString('th-TH', {day:'2-digit', month:'2-digit', year:'2-digit'});
        const timeStr = now.toLocaleTimeString('th-TH');
        
        row.innerHTML = `
            <td><span style="color:var(--accent)">${dateStr}</span> | ${timeStr}</td>
            <td>${type}</td>
            <td>${msg}</td>
            <td><span class="tag ${isAlert ? 'tag-alert' : 'tag-normal'}">${isAlert ? 'Alert' : 'Normal'}</span></td>
        `;
        tbody.prepend(row);
        if (tbody.rows.length > 50) tbody.deleteRow(50);
    }

    db.ref("/").on("value", (snapshot) => {
        const data = snapshot.val();
        if (data) {
            const t = data.temperature || 0;
            const h = data.Humidity || 0;
            const s = data.Soil || 0;
            const sec = data.Security == 1;

            // Update Metrics
            document.getElementById("t-val").innerText = t;
            document.getElementById("temp-bar").style.height = Math.min(t * 2, 100) + "%";
            document.getElementById("temp-bar").style.boxShadow = t > 30 ? "0 0 30px var(--danger)" : "0 0 25px var(--accent)";
            document.getElementById("h-val").innerText = h;
            document.getElementById("s-val").innerText = s;

            // Security UI
            document.getElementById("sec-icon").innerText = sec ? "üö®" : "üõ°Ô∏è";
            document.getElementById("sec-icon").style.textShadow = sec ? "0 0 30px var(--danger)" : "none";
            const secText = document.getElementById("sec-text");
            secText.innerText = sec ? "BREACH DETECTED!" : "STATUS READY";
            secText.style.color = sec ? "var(--danger)" : "var(--success)";

            // Devices Status
            const b1 = document.getElementById("bulb1"), s1 = document.getElementById("led1-status");
            const b2 = document.getElementById("bulb2"), s2 = document.getElementById("led2-status");
            const spk = document.getElementById("spk-icon"), sb = document.getElementById("bz-status");

            if(sec) {
                b1.classList.add("on"); s1.innerText = "ACTIVE"; s1.style.color = "var(--success)";
                spk.innerText = "üîä"; spk.style.opacity = "1"; spk.style.color = "var(--danger)";
                sb.innerText = "ACTIVE"; sb.style.color = "var(--success)";
            } else {
                b1.classList.remove("on"); s1.innerText = "OFFLINE"; s1.style.color = "var(--danger)";
                spk.innerText = "üîá"; spk.style.opacity = "0.3"; spk.style.color = "#fff";
                sb.innerText = "OFFLINE"; sb.style.color = "var(--danger)";
            }

            if(t > 30) { b2.classList.add("on"); s2.innerText = "ACTIVE"; s2.style.color = "var(--success)"; }
            else { b2.classList.remove("on"); s2.innerText = "OFFLINE"; s2.style.color = "var(--danger)"; }

            // Log Logic
            if (sec && lastSec === 0) { addLog("SECURITY", "Object intrusion detected in zone A", true); lastSec = 1; }
            else if (!sec) { lastSec = 0; }

            if (t > 30 && !lastT) { addLog("THERMAL", `High temperature threshold exceeded: ${t}¬∞C`, true); lastT = true; }
            else if (t <= 30) { lastT = false; }
        }
    });

    function clearLogs() { document.getElementById("log-body").innerHTML = ""; }
</script>
</body>
</html>
