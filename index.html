<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viewvi Smart Home (Pastel Edition)</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --pastel-pink: #FFC0CB; /* Light Pink */
            --pastel-blue: #ADD8E6; /* Light Blue */
            --pastel-green: #90EE90; /* Light Green */
            --pastel-yellow: #FFFFE0; /* Light Yellow */
            --pastel-orange: #FFDAB9; /* Peach */
            --text-dark: #333;
            --text-light: #fff;
            --card-bg: rgba(255, 255, 255, 0.7); /* Translucent white for cards */
            --glass-border: rgba(255, 255, 255, 0.5);
            --shadow-light: rgba(0, 0, 0, 0.1);
            --gradient-start: #ADD8E6; /* Sky blue */
            --gradient-end: #E0FFFF;   /* Light Cyan */
        }
        body {
            font-family: 'Kanit', sans-serif;
            margin: 0; padding: 0;
            background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
            overflow: hidden; /* Hide scrollbar for animation */
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            color: var(--text-dark);
        }

        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß: ‡πÄ‡∏°‡∏Ü‡∏•‡∏≠‡∏¢ */
        .animated-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: url('https://www.transparenttextures.com/patterns/white-prism.png') repeat;
            animation: moveClouds 60s linear infinite;
        }
        @keyframes moveClouds {
            from { background-position: 0 0; }
            to { background-position: 1000px 0; }
        }

        .container {
            max-width: 1200px; width: 95%; background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px); border-radius: 30px; padding: 30px;
            box-shadow: 0 15px 40px var(--shadow-light); border: 1px solid var(--glass-border);
            position: relative; /* For system-off overlay */
        }

        /* System Off Overlay */
        .system-off-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95); border-radius: 30px;
            display: none; align-items: center; justify-content: center; z-index: 5;
            color: var(--text-dark); font-size: 2rem; font-weight: bold;
        }
        .main-content-wrapper { position: relative; } /* Wrapper for content to apply overlay to */

        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px dashed rgba(0,0,0,0.2); }
        h1 { font-size: 2.2rem; font-weight: 700; color: var(--text-dark); text-shadow: 1px 1px 3px rgba(0,0,0,0.1); margin: 0; }
        
        .clock-box { text-align: left; }
        #clock { font-size: 1.6rem; font-weight: 700; color: var(--text-dark); }
        #date { font-size: 0.9rem; color: #666; }

        .system-switch button { padding: 8px 20px; border-radius: 20px; border: none; font-family: 'Kanit'; font-weight: 500; cursor: pointer; transition: 0.3s; margin-left: 10px; }
        .btn-on { background: var(--pastel-green); color: var(--text-dark); }
        .btn-off { background: var(--pastel-red); color: var(--text-light); }
        .btn-off.active { background: var(--pastel-red); color: var(--text-light); }
        .status-text { font-weight: 500; color: var(--text-dark); }
        
        .main-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .card { background: var(--card-bg); border-radius: 20px; padding: 20px; box-shadow: 0 5px 15px var(--shadow-light); text-align: center; border: 1px solid var(--glass-border); }
        
        /* ‡∏´‡∏•‡∏≠‡∏î‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ */
        .temp-meter {
            width: 35px; height: 150px; background: #EEE; border-radius: 18px;
            margin: 10px auto; border: 2px solid #CCC; position: relative; overflow: hidden;
        }
        #temp-fill {
            position: absolute; bottom: 0; width: 100%; height: 0%;
            background: linear-gradient(to top, var(--pastel-green), var(--pastel-yellow), var(--pastel-orange), var(--pastel-red));
            box-shadow: 0 0 15px rgba(255,160,0,0.5); /* Soft glow */
            transition: height 1s;
        }

        .val { font-size: 2.2rem; font-weight: 700; color: var(--text-dark); }
        .label { font-size: 0.9rem; color: #666; margin-bottom: 5px; }
        
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ */
        #sec-icon { font-size: 3.5rem; margin: 10px 0; }
        #sec-text { font-size: 1.1rem; font-weight: 700; }
        .alert-text { color: var(--pastel-red); }
        .normal-text { color: var(--pastel-green); }

        /* ‡πÅ‡∏ú‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ LED & Buzzer */
        .indicator-panel {
            background: var(--card-bg); border-radius: 20px; padding: 15px;
            display: flex; justify-content: space-around; align-items: center; margin-top: 20px;
            box-shadow: 0 5px 15px var(--shadow-light); border: 1px solid var(--glass-border);
        }
        .indicator-item { text-align: center; }
        .led-circle { width: 25px; height: 25px; border-radius: 50%; background: #BBB; margin: 8px auto; transition: 0.3s; border: 2px solid #999; }
        .led-temp.active { background: var(--pastel-orange); box-shadow: 0 0 10px var(--pastel-orange); }
        .led-object.active { background: var(--pastel-red); box-shadow: 0 0 10px var(--pastel-red); }
        .buzzer-status-icon { font-size: 1.5rem; color: #666; }
        .buzzer-status-icon.active { color: var(--pastel-red); animation: pulse 1s infinite; }

        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å */
        .history-section { background: var(--card-bg); border-radius: 20px; padding: 20px; margin-top: 20px; box-shadow: 0 5px 15px var(--shadow-light); border: 1px solid var(--glass-border); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: center; border-bottom: 1px solid rgba(0,0,0,0.1); }
        th { background: rgba(0,0,0,0.05); color: var(--text-dark); }
        tr:last-child td { border-bottom: none; }
        .log-alert { color: var(--pastel-red); font-weight: 500; }
        
        /* Animation */
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>
<div class="animated-background"></div>

<div class="container">
    <div class="main-content-wrapper">
        <div class="system-off-overlay" id="system-off-overlay">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>

        <div class="top-bar">
            <h1>üè† Viewvi Smart Home</h1>
            <div>
                <div id="clock">00:00:00</div>
                <div id="date">--</div>
            </div>
            <div>
                <span id="sys-status-text" class="status-text">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                <button class="btn-on" onclick="toggleSystem(1)">‡πÄ‡∏õ‡∏¥‡∏î</button>
                <button class="btn-off" onclick="toggleSystem(0)">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>

        <div class="main-grid">
            <div class="card">
                <div class="label">üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</div>
                <div class="temp-meter"><div id="temp-fill"></div></div>
                <div class="val"><span id="t-val">--</span>¬∞C</div>
            </div>
            <div class="card">
                <div class="label">üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</div>
                <div class="val" id="h-val" style="color:var(--pastel-blue)">--%</div>
                <hr style="border-color: rgba(0,0,0,0.1); margin: 15px 0;">
                <div class="label">üå± ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏î‡∏¥‡∏ô</div>
                <div class="val" id="s-val" style="color:var(--pastel-green)">--%</div>
            </div>
            <div class="card">
                <div class="label">üõ°Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</div>
                <div id="sec-icon" style="font-size: 4rem; margin: 15px 0;">üõ°Ô∏è</div>
                <div id="sec-text" class="normal-text" style="font-size: 1.2rem; font-weight:700;">‡∏õ‡∏Å‡∏ï‡∏¥</div>
            </div>
        </div>

        <div class="indicator-panel">
            <div class="indicator-item">
                <div class="label">LED ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</div>
                <div id="led-temp" class="led-circle led-temp"></div>
            </div>
            <div class="indicator-item">
                <div class="label">LED ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</div>
                <div id="led-object" class="led-circle led-object"></div>
            </div>
            <div class="indicator-item">
                <div class="label">‡∏ö‡∏±‡∏ã‡πÄ‡∏ã‡∏≠‡∏£‡πå</div>
                <div id="buzzer-icon" class="buzzer-status-icon">üîá</div>
                <div id="buzzer-text" style="font-size: 0.8rem;">‡πÄ‡∏á‡∏µ‡∏¢‡∏ö</div>
            </div>
        </div>

        <div class="history-section">
            <h3 style="margin-top:0;">üìã ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h3>
            <table>
                <thead>
                    <tr>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                        <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</th>
                        <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏</th>
                    </tr>
                </thead>
                <tbody id="log-table"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://viewvi-3e5ef-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function updateClock() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString('th-TH');
        document.getElementById('date').innerText = now.toLocaleDateString('th-TH', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    }
    setInterval(updateClock, 1000);

    function toggleSystem(status) {
        db.ref("/SystemStatus").set(status);
    }

    db.ref("/").on("value", (snapshot) => {
        const data = snapshot.val();
        if (data) {
            const isSystemOn = data.SystemStatus === 1;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö
            document.getElementById("sys-status-text").innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " + (isSystemOn ? "‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" : "‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô");
            document.getElementById("sys-status-text").style.color = isSystemOn ? "var(--pastel-green)" : "var(--pastel-red)";

            // ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Overlay ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∂‡∏ö‡∏Ç‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
            document.getElementById("system-off-overlay").style.display = isSystemOn ? "none" : "flex";
            document.getElementById("history-section").style.opacity = isSystemOn ? "1" : "0.5";

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ LED/Buzzer ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            const ledTemp = document.getElementById("led-temp");
            const ledObject = document.getElementById("led-object");
            const buzzerIcon = document.getElementById("buzzer-icon");
            const buzzerText = document.getElementById("buzzer-text");

            if (isSystemOn) {
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå
                const temp = data.temperature || 0;
                document.getElementById("t-val").innerText = temp;
                document.getElementById("temp-fill").style.height = Math.min((temp/50)*100, 100) + "%"; // Max 50C for 100% fill

                document.getElementById("h-val").innerText = (data.Humidity || "--") + "%";
                const soil = data.Soil || 0;
                document.getElementById("s-val").innerText = soil + "%";

                const isAlert = data.Security === 1;
                document.getElementById("sec-text").innerText = isAlert ? "‚ö†Ô∏è ‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏!" : "‡∏õ‡∏Å‡∏ï‡∏¥";
                document.getElementById("sec-text").className = isAlert ? "alert-text" : "normal-text";
                document.getElementById("sec-icon").innerText = isAlert ? "üö®" : "üõ°Ô∏è";

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ LED & Buzzer (‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î)
                if (temp > 30) ledTemp.classList.add("active"); else ledTemp.classList.remove("active");
                if (isAlert) ledObject.classList.add("active"); else ledObject.classList.remove("active");
                
                if (isAlert) {
                    buzzerIcon.classList.add("active");
                    buzzerIcon.innerText = "üîä";
                    buzzerText.innerText = "‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á";
                    buzzerText.style.color = "var(--pastel-red)";
                } else {
                    buzzerIcon.classList.remove("active");
                    buzzerIcon.innerText = "üîá";
                    buzzerText.innerText = "‡πÄ‡∏á‡∏µ‡∏¢‡∏ö";
                    buzzerText.style.color = var(--text-dark);
                }

                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                const table = document.getElementById("log-table");
                const row = table.insertRow(0);
                row.innerHTML = `<td>${new Date().toLocaleDateString('th-TH')}</td><td>${new Date().toLocaleTimeString('th-TH')}</td><td>${temp}¬∞C</td><td>${soil}%</td><td class="${isAlert?'log-alert':''}">${isAlert?'‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏':'‡∏õ‡∏Å‡∏ï‡∏¥'}</td>`;
                if (table.rows.length > 10) table.deleteRow(10); // ‡πÄ‡∏Å‡πá‡∏ö 10 ‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            } else {
                // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏ü LED ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö
                document.getElementById("t-val").innerText = "--";
                document.getElementById("temp-fill").style.height = "0%";
                document.getElementById("h-val").innerText = "--%";
                document.getElementById("s-val").innerText = "--%";
                document.getElementById("sec-text").innerText = "‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö";
                document.getElementById("sec-icon").innerText = "‚ö™"; // ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏õ‡∏¥‡∏î
                
                ledTemp.classList.remove("active");
                ledObject.classList.remove("active");
                buzzerIcon.classList.remove("active");
                buzzerIcon.innerText = "üîá";
                buzzerText.innerText = "‡πÄ‡∏á‡∏µ‡∏¢‡∏ö";
                buzzerText.style.color = var(--text-dark);

                document.getElementById("log-table").innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            }
        }
    });
</script>
</body>
</html>
